type: databricks_workspace_bundles_demo.components.CustomDbtProjectComponent

attributes:
  # Path to common dbt project with target specification
  project:
    project_dir: "{{ project_root }}/dbt_projects/common_analytics_dbt"
    target: "eu"

  # Unique op name to avoid collisions with other region components
  op:
    name: "dbt_eu_common"

  # Select only EU-specific sources and all region-agnostic models
  select: "source:*_eu tag:eu"

  # Translation: organize by medallion layer + region, clean names without prefix/suffix
  translation:
    key: "{% if node.resource_type == 'source' %}raw/eu/{{ node.name | replace('raw_', '') | replace('_eu', '') }}{% elif 'cohort' in node.name %}gold/eu/{{ node.name }}{% else %}silver/eu/{{ node.name }}{% endif %}"
    group_name: eu_dbt_analytics_common

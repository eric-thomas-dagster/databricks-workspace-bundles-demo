type: databricks_workspace_bundles_demo.components.CustomDbtProjectComponent

attributes:
  # Path to common dbt project with target specification
  project:
    project_dir: "{{ project_root }}/dbt_projects/common_analytics_dbt"
    target: "us"

  # Unique op name to avoid collisions with other region components
  op:
    name: "dbt_us_common"

  # Select only US-tagged models (sources are dynamically referenced via target.name)
  select: "tag:us"

  # Translation: organize by medallion layer + region, clean names without prefix/suffix
  translation:
    key: "{% if node.resource_type == 'source' %}raw/us/{{ node.name | replace('raw_', '') | replace('_us', '') }}{% elif 'cohort' in node.name %}gold/us/{{ node.name }}{% else %}silver/us/{{ node.name }}{% endif %}"
    group_name: us_dbt_analytics_common

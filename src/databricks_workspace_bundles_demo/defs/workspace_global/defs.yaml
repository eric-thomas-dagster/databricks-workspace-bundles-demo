# Global Workspace - Uses official DatabricksWorkspaceComponent pattern
# Aggregates data from US and EU regional workspaces
# Properly subclasses the official component with demo mode support
# Set DAGSTER_DEMO_MODE=true to enable demo mode simulation
type: databricks_workspace_bundles_demo.components.CustomDatabricksWorkspaceComponent

attributes:
  # Workspace connection
  workspace:
    host: "{{ env.DATABRICKS_GLOBAL_HOST | default('https://global.databricks.com') }}"
    token: "{{ env.DATABRICKS_GLOBAL_TOKEN | default('demo-token-global') }}"

  # Optional: Filter which jobs to include (commented out for demo)
  # Optional: Filter which jobs to include by job ID
  # databricks_filter:
  #   include_jobs:
  #     job_ids: [123, 456]  # Only include these job IDs

  # Map Databricks task keys to Dagster asset specs
  assets_by_task_key:
    global_customer_consolidation_task:
      - key: gold/global/customer_master
        group_name: global_analytics
        owners: ["global-analytics-team@company.com"]
        deps: [silver/us/customer_360, silver/eu/customer_360, gold/us/customer_cohorts, gold/eu/customer_cohorts]  # Cross-regional dependencies including dbt
        kinds: [deltalake, sql, job, table]
        description: "Global unified customer master data combining US and EU regions"
        metadata:
          layer: "gold"
          update_frequency: "hourly"
          data_classification: "confidential"
          region: "GLOBAL"
          source_regions: ["US", "EU"]
          contains_pii: true
          gdpr_compliant: true
          integration_type: "workspace_job"
          task_type: "databricks_job"
          databricks_workspace_host: "{{ env.DATABRICKS_GLOBAL_HOST | default('https://global.databricks.com') }}"

    global_sales_analytics_task:
      - key: gold/global/sales_insights
        group_name: global_analytics
        owners: ["global-analytics-team@company.com"]
        deps: [gold/us/sales_insights, gold/eu/sales_insights, gold/global/customer_master]  # Cross-regional dependencies
        kinds: [deltalake, sql, job, dashboard]
        description: "Global sales performance with cross-regional comparisons and consolidated metrics"
        metadata:
          layer: "gold"
          update_frequency: "daily"
          region: "GLOBAL"
          dashboard_url: "https://bi.company.com/global-sales"
          cross_regional_analysis: true
          integration_type: "workspace_job"
          task_type: "databricks_job"
          databricks_workspace_host: "{{ env.DATABRICKS_GLOBAL_HOST | default('https://global.databricks.com') }}"

    global_financial_consolidation_task:
      - key: gold/global/financial_summary
        group_name: global_analytics
        owners: ["global-finance-team@company.com"]
        deps: [gold/us/financial_summary, gold/eu/financial_summary]  # Cross-regional dependencies
        kinds: [deltalake, sql, job, report]
        description: "Global consolidated financial statements with currency normalization"
        metadata:
          layer: "gold"
          update_frequency: "daily"
          region: "GLOBAL"
          compliance_frameworks: ["IFRS", "SOX", "GAAP"]
          currency_normalization: "USD"
          consolidation_method: "equity"
          integration_type: "workspace_job"
          task_type: "databricks_job"
          databricks_workspace_host: "{{ env.DATABRICKS_GLOBAL_HOST | default('https://global.databricks.com') }}"

    cross_regional_comparison_task:
      - key: gold/global/cross_regional_analysis
        group_name: global_analytics
        owners: ["global-analytics-team@company.com"]
        deps: [gold/us/sales_insights, gold/eu/sales_insights, silver/us/customer_360, silver/eu/customer_360]  # Multiple cross-regional dependencies
        kinds: [deltalake, sql, job, dashboard]
        description: "Cross-regional performance comparison and market analysis"
        metadata:
          layer: "gold"
          update_frequency: "weekly"
          region: "GLOBAL"
          dashboard_url: "https://bi.company.com/regional-comparison"
          analysis_type: "comparative"
          integration_type: "workspace_job"
          task_type: "databricks_job"
          databricks_workspace_host: "{{ env.DATABRICKS_GLOBAL_HOST | default('https://global.databricks.com') }}"

requirements:
  env:
    - DATABRICKS_GLOBAL_HOST
    - DATABRICKS_GLOBAL_TOKEN

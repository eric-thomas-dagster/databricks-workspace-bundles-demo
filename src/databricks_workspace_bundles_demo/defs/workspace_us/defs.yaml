# US Regional Workspace - Uses official DatabricksWorkspaceComponent pattern
# Properly subclasses the official component with demo mode support
# Set DAGSTER_DEMO_MODE=true to enable demo mode simulation
type: databricks_workspace_bundles_demo.components.CustomDatabricksWorkspaceComponent

attributes:
  # Workspace connection
  workspace:
    host: "{{ env.DATABRICKS_US_HOST | default('https://us.databricks.com') }}"
    token: "{{ env.DATABRICKS_US_TOKEN | default('demo-token-us') }}"

  # Optional: Filter which jobs to include (commented out for demo)
  # Optional: Filter which jobs to include by job ID
  # databricks_filter:
  #   include_jobs:
  #     job_ids: [123, 456]  # Only include these job IDs

  # Map Databricks task keys to Dagster asset specs
  assets_by_task_key:
    us_customer_analytics_task:
      - key: silver/us/customer_360
        group_name: us_analytics
        owners: ["us-analytics-team@company.com"]
        deps: [raw/us/customer_data, raw/us/sales_orders]
        kinds: [deltalake, sql, job, table]
        description: "US customer 360 view aggregating CRM, e-commerce, and transactional data"
        metadata:
          layer: "silver"
          update_frequency: "hourly"
          data_classification: "confidential"
          region: "US"
          contains_pii: true
          integration_type: "workspace_job"
          task_type: "databricks_job"
          databricks_workspace_host: "{{ env.DATABRICKS_US_HOST | default('https://us.databricks.com') }}"

    us_sales_insights_task:
      - key: gold/us/sales_insights
        group_name: us_analytics
        owners: ["us-analytics-team@company.com"]
        deps: [silver/us/customer_360, raw/us/product_catalog]
        kinds: [deltalake, sql, job, dashboard]
        description: "US regional sales insights and performance dashboards"
        metadata:
          layer: "gold"
          update_frequency: "daily"
          region: "US"
          dashboard_url: "https://bi.company.com/us-sales"
          integration_type: "workspace_job"
          task_type: "databricks_job"
          databricks_workspace_host: "{{ env.DATABRICKS_US_HOST | default('https://us.databricks.com') }}"

    us_financial_reporting_task:
      - key: gold/us/financial_summary
        group_name: us_analytics
        owners: ["us-finance-team@company.com"]
        deps: [raw/us/financial_transactions, gold/us/sales_insights]
        kinds: [deltalake, sql, job, report]
        description: "US regional financial summary with P&L and cash flow"
        metadata:
          layer: "gold"
          update_frequency: "daily"
          region: "US"
          compliance_frameworks: ["SOX", "GAAP"]
          integration_type: "workspace_job"
          task_type: "databricks_job"
          databricks_workspace_host: "{{ env.DATABRICKS_US_HOST | default('https://us.databricks.com') }}"

requirements:
  env:
    - DATABRICKS_US_HOST
    - DATABRICKS_US_TOKEN
